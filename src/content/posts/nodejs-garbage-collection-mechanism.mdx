---
author: XDong
categories: ["nodejs garbage-coillection"]
date: 28/01/2024
featured: false
image: ./images/record.jpg
title: NodeJs 垃圾回收机制
---

Node.js 的垃圾回收机制主要依赖于 V8 JavaScript 引擎，它是 Node.js 使用的 JavaScript 引擎。V8 引擎使用一种称为标记-清除（Mark-and-Sweep）的垃圾回收策略，以及分代式垃圾回收机制。下面是这一机制的简要概述：

### 标记-清除算法 这是 V8 的主要垃圾回收机制。工作时分为“标记”和“清除”两个阶段：

  - 标记阶段：垃圾回收器遍历堆中的所有对象，标记那些从根（如全局对象、活动的函数调用等）可达的对象。可达的对象被认为是“活跃的”或“必要的”，不应该被回收。
  - 清除阶段：清除未被标记的对象，即那些不可达的对象，因为它们被认为是“垃圾”。

### 分代式垃圾回收 V8 引擎将堆内存分为两部分，即“新生代”和“老生代”：

  - 新生代：用于存放生命周期较短的小对象。新创建的对象首先被分配到新生代区域。这个区域的垃圾回收频率较高，但每次回收所需时间较短。
  - 老生代：存放生命周期较长或经常被引用的大对象。当对象在新生代中存活足够长的时间后，或者新生代空间不足时，它们会被转移到老生代区域。老生代的垃圾回收频率较低，但每次回收所需时间更长。
### 增量回收
  - 为了减少垃圾回收对主线程的阻塞时间，V8 实现了增量回收。这意味着垃圾回收过程被分割成多个小部分，每次只执行一小部分回收任务，这样可以减少每次回收对应用性能的影响。

### 懒性清理和压缩
  - 在清理未使用的内存时，V8 会尽可能懒惰地进行，只在需要时进行清理。此外，为了优化内存的连续性和减少碎片化，V8 也会在一定条件下进行内存压缩。

Node.js 中的垃圾回收是一个自动过程，但是它有时会对性能产生影响。因此，了解和监控垃圾回收行为对于优化 Node.js 应用的性能是很重要的。开发者可以使用 Node.js 提供的一些工具和标志来监控和调整垃圾回收行为，例如使用 --trace-gc 标志来追踪垃圾回收事件。





